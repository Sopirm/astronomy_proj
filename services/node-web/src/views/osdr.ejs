<!-- OSDR Experiments Page -->
<div class="animate__animated animate__fadeIn">
  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-500">
      üß™ OSDR - –ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
    </h1>
    <p class="text-gray-400 mt-2">Open Science Data Repository - –Ω–∞—É—á–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –≤ –∫–æ—Å–º–æ—Å–µ</p>
    <div class="mt-3 text-sm text-gray-500">
      –ò—Å—Ç–æ—á–Ω–∏–∫: <code class="bg-slate-700 px-2 py-1 rounded text-green-400"><%= src %></code>
    </div>
  </div>

  <!-- Filter & Search Panel -->
  <div class="space-card rounded-lg p-6 mb-6 animate__animated animate__fadeInDown">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center space-x-4">
        <h3 class="text-lg font-semibold text-cyan-400">üîç –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫</h3>
      </div>
      
      <div class="flex flex-wrap items-center gap-3">
        <!-- Search Input -->
        <div class="relative">
          <input type="text" 
                 id="search-input" 
                 placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, ID..." 
                 class="bg-slate-700 border border-gray-600 rounded-lg px-4 py-2 pl-10 text-sm w-64 focus:border-cyan-400 focus:outline-none">
          <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
            üîç
          </div>
        </div>

        <!-- Status Filter -->
        <select id="status-filter" class="bg-slate-700 border border-gray-600 rounded-lg px-3 py-2 text-sm">
          <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
          <option value="completed">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</option>
          <option value="pending">–û–∂–∏–¥–∞—é—â–∏–µ</option>
        </select>

        <!-- Sort Options -->
        <select id="sort-options" class="bg-slate-700 border border-gray-600 rounded-lg px-3 py-2 text-sm">
          <option value="updated_at_desc">–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Üì</option>
          <option value="updated_at_asc">–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Üë</option>
          <option value="title_asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é ‚Üë</option>
          <option value="title_desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é ‚Üì</option>
          <option value="id_asc">–ü–æ ID ‚Üë</option>
          <option value="id_desc">–ü–æ ID ‚Üì</option>
        </select>

        <!-- View Toggle -->
        <div class="flex bg-slate-700 rounded-lg p-1">
          <button id="view-cards" class="px-3 py-1 rounded text-sm bg-cyan-600 text-white transition-all">
            üìã –ö–∞—Ä—Ç–æ—á–∫–∏
          </button>
          <button id="view-table" class="px-3 py-1 rounded text-sm text-gray-400 hover:text-white transition-all">
            üìä –¢–∞–±–ª–∏—Ü–∞  
          </button>
        </div>

        <!-- Export Button -->
        <button id="export-btn" 
                class="px-4 py-2 bg-green-600 bg-opacity-20 hover:bg-opacity-30 border border-green-500 rounded-lg text-green-400 text-sm transition-all">
          üì• –≠–∫—Å–ø–æ—Ä—Ç CSV
        </button>
      </div>
    </div>

    <!-- Filter Summary -->
    <div class="mt-4 pt-4 border-t border-gray-600">
      <div class="flex items-center justify-between text-sm">
        <div class="text-gray-400">
          –ü–æ–∫–∞–∑–∞–Ω–æ: <span id="filtered-count" class="text-cyan-400 font-semibold"><%= items.length %></span> –∏–∑ 
          <span id="total-count" class="text-white font-semibold"><%= items.length %></span> —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
        </div>
        <div class="flex items-center space-x-4">
          <button id="reset-filters" class="text-gray-400 hover:text-cyan-400 transition-colors">
            üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards View -->
  <div id="cards-view">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="experiments-grid">
      <% items.forEach((item, index) => { %>
      <div class="experiment-card space-card rounded-lg p-5 animate__animated animate__fadeInUp hover:scale-105 transition-transform cursor-pointer" 
           style="animation-delay: <%= (index * 0.05) %>s"
           data-item='<%- JSON.stringify(item) %>'>
        
        <!-- Experiment Header -->
        <div class="flex items-start justify-between mb-4">
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-cyan-400 mb-1 line-clamp-2">
              <%= item.title || `–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ${item.dataset_id || item.id}` %>
            </h4>
            <div class="text-sm text-gray-400">
              ID: <span class="text-white font-mono"><%= item.dataset_id || item.id %></span>
            </div>
          </div>
          
          <div class="ml-3">
            <% if (item.status) { %>
            <span class="px-2 py-1 text-xs rounded-full
              <%= item.status === 'active' ? 'bg-green-600 bg-opacity-20 text-green-400 border border-green-500' : 
                  item.status === 'completed' ? 'bg-blue-600 bg-opacity-20 text-blue-400 border border-blue-500' :
                  'bg-yellow-600 bg-opacity-20 text-yellow-400 border border-yellow-500' %>">
              <%= item.status %>
            </span>
            <% } %>
          </div>
        </div>

        <!-- Experiment Details -->
        <div class="space-y-2 text-sm">
          <% if (item.updated_at) { %>
          <div class="flex justify-between">
            <span class="text-gray-400">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</span>
            <span class="text-gray-300"><%= new Date(item.updated_at).toLocaleDateString('ru-RU') %></span>
          </div>
          <% } %>
          
          <% if (item.inserted_at) { %>
          <div class="flex justify-between">
            <span class="text-gray-400">–°–æ–∑–¥–∞–Ω–æ:</span>
            <span class="text-gray-300"><%= new Date(item.inserted_at).toLocaleDateString('ru-RU') %></span>
          </div>
          <% } %>

          <% if (item.rest_url) { %>
          <div class="flex justify-between">
            <span class="text-gray-400">API:</span>
            <a href="<%= item.rest_url %>" target="_blank" 
               class="text-blue-400 hover:text-blue-300 text-xs font-mono transition-colors">
              üîó REST API
            </a>
          </div>
          <% } %>
        </div>

        <!-- Action Buttons -->
        <div class="mt-4 pt-4 border-t border-gray-600">
          <div class="flex space-x-2">
            <button class="flex-1 px-3 py-2 bg-cyan-600 bg-opacity-20 hover:bg-opacity-30 border border-cyan-500 rounded text-cyan-400 text-sm transition-all"
                    onclick="viewDetails('<%= item.id %>')">
              üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
            </button>
            <% if (item.rest_url) { %>
            <button class="px-3 py-2 bg-blue-600 bg-opacity-20 hover:bg-opacity-30 border border-blue-500 rounded text-blue-400 text-sm transition-all"
                    onclick="window.open('<%= item.rest_url %>', '_blank')">
              üîó API
            </button>
            <% } %>
          </div>
        </div>
      </div>
      <% }); %>
    </div>
  </div>

  <!-- Table View -->
  <div id="table-view" style="display: none;">
    <div class="space-card rounded-lg p-6 animate__animated animate__fadeInUp">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="text-left py-3 px-3 text-gray-400 cursor-pointer hover:text-cyan-400" data-sort="id">
                ID <span class="sort-indicator">‚ÜïÔ∏è</span>
              </th>
              <th class="text-left py-3 px-3 text-gray-400 cursor-pointer hover:text-cyan-400" data-sort="title">
                –ù–∞–∑–≤–∞–Ω–∏–µ <span class="sort-indicator">‚ÜïÔ∏è</span>
              </th>
              <th class="text-left py-3 px-3 text-gray-400 cursor-pointer hover:text-cyan-400" data-sort="status">
                –°—Ç–∞—Ç—É—Å <span class="sort-indicator">‚ÜïÔ∏è</span>
              </th>
              <th class="text-left py-3 px-3 text-gray-400 cursor-pointer hover:text-cyan-400" data-sort="updated_at">
                –û–±–Ω–æ–≤–ª–µ–Ω–æ <span class="sort-indicator">‚ÜïÔ∏è</span>
              </th>
              <th class="text-left py-3 px-3 text-gray-400">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody id="experiments-table-body">
            <% items.forEach(item => { %>
            <tr class="border-b border-gray-700 hover:bg-slate-700 hover:bg-opacity-30 experiment-row" 
                data-item='<%- JSON.stringify(item) %>'>
              <td class="py-3 px-3">
                <span class="font-mono text-cyan-400"><%= item.dataset_id || item.id %></span>
              </td>
              <td class="py-3 px-3">
                <div class="max-w-xs">
                  <div class="font-medium text-white truncate">
                    <%= item.title || `–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ${item.dataset_id || item.id}` %>
                  </div>
                </div>
              </td>
              <td class="py-3 px-3">
                <% if (item.status) { %>
                <span class="px-2 py-1 text-xs rounded-full
                  <%= item.status === 'active' ? 'bg-green-600 bg-opacity-20 text-green-400' : 
                      item.status === 'completed' ? 'bg-blue-600 bg-opacity-20 text-blue-400' :
                      'bg-yellow-600 bg-opacity-20 text-yellow-400' %>">
                  <%= item.status %>
                </span>
                <% } else { %>
                <span class="text-gray-500">‚Äî</span>
                <% } %>
              </td>
              <td class="py-3 px-3 text-gray-300">
                <%= item.updated_at ? new Date(item.updated_at).toLocaleDateString('ru-RU') : '‚Äî' %>
              </td>
              <td class="py-3 px-3">
                <div class="flex space-x-1">
                  <button class="px-2 py-1 bg-cyan-600 bg-opacity-20 hover:bg-opacity-30 rounded text-cyan-400 text-xs"
                          onclick="viewDetails('<%= item.id %>')">
                    üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–æ
                  </button>
                  <% if (item.rest_url) { %>
                  <button class="px-2 py-1 bg-blue-600 bg-opacity-20 hover:bg-opacity-30 rounded text-blue-400 text-xs"
                          onclick="window.open('<%= item.rest_url %>', '_blank')">
                    üîó API
                  </button>
                  <% } %>
                </div>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div id="empty-state" class="text-center py-12 space-card rounded-lg" style="display: none;">
    <div class="text-6xl mb-4">üîç</div>
    <h3 class="text-xl font-semibold text-gray-400 mb-2">–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p class="text-gray-500">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
    <button class="mt-4 px-4 py-2 bg-cyan-600 bg-opacity-20 hover:bg-opacity-30 border border-cyan-500 rounded text-cyan-400 transition-all"
            onclick="resetFilters()">
      üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    </button>
  </div>
</div>

<!-- Detail Modal -->
<div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
  <div class="space-card rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold text-cyan-400">üî¨ –î–µ—Ç–∞–ª–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞</h3>
      <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">‚úï</button>
    </div>
    <div id="modal-content"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  console.log('üß™ OSDR Page –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');

  // –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
  const allItems = <%- JSON.stringify(items) %>;
  let filteredItems = [...allItems];
  let currentView = 'cards';

  // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  const searchInput = document.getElementById('search-input');
  const statusFilter = document.getElementById('status-filter');
  const sortOptions = document.getElementById('sort-options');
  const viewCards = document.getElementById('view-cards');
  const viewTable = document.getElementById('view-table');
  const cardsView = document.getElementById('cards-view');
  const tableView = document.getElementById('table-view');
  const emptyState = document.getElementById('empty-state');

  // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞
  function filterItems() {
    const searchTerm = searchInput.value.toLowerCase();
    const statusTerm = statusFilter.value;
    
    filteredItems = allItems.filter(item => {
      // –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ info.txt)
      const searchMatch = !searchTerm || 
        (item.title && item.title.toLowerCase().includes(searchTerm)) ||
        (item.dataset_id && item.dataset_id.toLowerCase().includes(searchTerm)) ||
        (item.id && item.id.toString().includes(searchTerm));
      
      // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
      const statusMatch = !statusTerm || item.status === statusTerm;
      
      return searchMatch && statusMatch;
    });

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ info.txt - –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é/—É–±—ã–≤–∞–Ω–∏—é —Å –≤—ã–±–æ—Ä–æ–º —Å—Ç–æ–ª–±—Ü–∞)
    sortItems();
    renderItems();
    updateFilterSummary();
  }

  // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  function sortItems() {
    const [field, direction] = sortOptions.value.split('_');
    
    filteredItems.sort((a, b) => {
      let aVal = a[field] || '';
      let bVal = b[field] || '';
      
      // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∞—Ç
      if (field === 'updated_at' || field === 'inserted_at') {
        aVal = new Date(aVal || 0);
        bVal = new Date(bVal || 0);
      }
      
      // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—Ç—Ä–æ–∫
      if (typeof aVal === 'string') {
        aVal = aVal.toLowerCase();
        bVal = bVal.toLowerCase();
      }
      
      if (direction === 'asc') {
        return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
      } else {
        return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
      }
    });
  }

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
  function renderItems() {
    if (filteredItems.length === 0) {
      cardsView.style.display = 'none';
      tableView.style.display = 'none';
      emptyState.style.display = 'block';
      return;
    }

    emptyState.style.display = 'none';
    
    if (currentView === 'cards') {
      renderCards();
      cardsView.style.display = 'block';
      tableView.style.display = 'none';
    } else {
      renderTable();
      cardsView.style.display = 'none';
      tableView.style.display = 'block';
    }
  }

  function renderCards() {
    const grid = document.getElementById('experiments-grid');
    grid.innerHTML = filteredItems.map((item, index) => `
      <div class="experiment-card space-card rounded-lg p-5 animate__animated animate__fadeInUp hover:scale-105 transition-transform cursor-pointer"
           style="animation-delay: ${index * 0.05}s"
           onclick="viewDetails('${item.id}')">
        <div class="flex items-start justify-between mb-4">
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-cyan-400 mb-1">
              ${item.title || `–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ${item.dataset_id || item.id}`}
            </h4>
            <div class="text-sm text-gray-400">
              ID: <span class="text-white font-mono">${item.dataset_id || item.id}</span>
            </div>
          </div>
          ${item.status ? `
            <span class="px-2 py-1 text-xs rounded-full ${getStatusClass(item.status)}">
              ${item.status}
            </span>
          ` : ''}
        </div>
        <div class="space-y-2 text-sm">
          ${item.updated_at ? `
            <div class="flex justify-between">
              <span class="text-gray-400">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</span>
              <span class="text-gray-300">${new Date(item.updated_at).toLocaleDateString('ru-RU')}</span>
            </div>
          ` : ''}
          ${item.rest_url ? `
            <div class="flex justify-between">
              <span class="text-gray-400">API:</span>
              <a href="${item.rest_url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs font-mono transition-colors">
                üîó REST API
              </a>
            </div>
          ` : ''}
        </div>
      </div>
    `).join('');
  }

  function renderTable() {
    const tbody = document.getElementById('experiments-table-body');
    tbody.innerHTML = filteredItems.map(item => `
      <tr class="border-b border-gray-700 hover:bg-slate-700 hover:bg-opacity-30 experiment-row">
        <td class="py-3 px-3">
          <span class="font-mono text-cyan-400">${item.dataset_id || item.id}</span>
        </td>
        <td class="py-3 px-3">
          <div class="font-medium text-white">${item.title || `–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ${item.dataset_id || item.id}`}</div>
        </td>
        <td class="py-3 px-3">
          ${item.status ? `
            <span class="px-2 py-1 text-xs rounded-full ${getStatusClass(item.status)}">${item.status}</span>
          ` : '<span class="text-gray-500">‚Äî</span>'}
        </td>
        <td class="py-3 px-3 text-gray-300">
          ${item.updated_at ? new Date(item.updated_at).toLocaleDateString('ru-RU') : '‚Äî'}
        </td>
        <td class="py-3 px-3">
          <div class="flex space-x-1">
            <button class="px-2 py-1 bg-cyan-600 bg-opacity-20 hover:bg-opacity-30 rounded text-cyan-400 text-xs"
                    onclick="viewDetails('${item.id}')">üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–æ</button>
            ${item.rest_url ? `
              <button class="px-2 py-1 bg-blue-600 bg-opacity-20 hover:bg-opacity-30 rounded text-blue-400 text-xs"
                      onclick="window.open('${item.rest_url}', '_blank')">üîó API</button>
            ` : ''}
          </div>
        </td>
      </tr>
    `).join('');
  }

  function getStatusClass(status) {
    switch (status) {
      case 'active': return 'bg-green-600 bg-opacity-20 text-green-400 border border-green-500';
      case 'completed': return 'bg-blue-600 bg-opacity-20 text-blue-400 border border-blue-500';
      default: return 'bg-yellow-600 bg-opacity-20 text-yellow-400 border border-yellow-500';
    }
  }

  function updateFilterSummary() {
    document.getElementById('filtered-count').textContent = filteredItems.length;
    document.getElementById('total-count').textContent = allItems.length;
  }

  // Event listeners
  searchInput.addEventListener('input', filterItems);
  statusFilter.addEventListener('change', filterItems);
  sortOptions.addEventListener('change', filterItems);

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–æ–≤
  viewCards.addEventListener('click', () => {
    currentView = 'cards';
    viewCards.classList.add('bg-cyan-600', 'text-white');
    viewCards.classList.remove('text-gray-400');
    viewTable.classList.remove('bg-cyan-600', 'text-white');
    viewTable.classList.add('text-gray-400');
    renderItems();
  });

  viewTable.addEventListener('click', () => {
    currentView = 'table';
    viewTable.classList.add('bg-cyan-600', 'text-white');
    viewTable.classList.remove('text-gray-400');
    viewCards.classList.remove('bg-cyan-600', 'text-white');
    viewCards.classList.add('text-gray-400');
    renderItems();
  });

  // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
  document.getElementById('reset-filters').addEventListener('click', () => {
    searchInput.value = '';
    statusFilter.value = '';
    sortOptions.value = 'updated_at_desc';
    filterItems();
  });

  // –≠–∫—Å–ø–æ—Ä—Ç CSV
  document.getElementById('export-btn').addEventListener('click', () => {
    const csv = [
      ['ID', 'Dataset ID', 'Title', 'Status', 'Updated At', 'Created At', 'REST URL'],
      ...filteredItems.map(item => [
        item.id || '',
        item.dataset_id || '',
        item.title || '',
        item.status || '',
        item.updated_at || '',
        item.inserted_at || '',
        item.rest_url || ''
      ])
    ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `osdr_experiments_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    URL.revokeObjectURL(url);
  });

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  window.viewDetails = function(id) {
    const item = allItems.find(i => i.id == id);
    if (!item) return;
    
    const modal = document.getElementById('detail-modal');
    const content = document.getElementById('modal-content');
    
    content.innerHTML = `
      <div class="space-y-4">
        <h4 class="text-lg font-semibold text-white">${item.title || `–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ${item.dataset_id || item.id}`}</h4>
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div><span class="text-gray-400">ID:</span> <span class="text-white font-mono">${item.id}</span></div>
          <div><span class="text-gray-400">Dataset ID:</span> <span class="text-white font-mono">${item.dataset_id || '‚Äî'}</span></div>
          <div><span class="text-gray-400">–°—Ç–∞—Ç—É—Å:</span> ${item.status ? `<span class="${getStatusClass(item.status)} px-2 py-1 rounded">${item.status}</span>` : '‚Äî'}</div>
          <div><span class="text-gray-400">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</span> <span class="text-white">${item.updated_at ? new Date(item.updated_at).toLocaleString('ru-RU') : '‚Äî'}</span></div>
        </div>
        ${item.rest_url ? `
          <div class="pt-4 border-t border-gray-600">
            <a href="${item.rest_url}" target="_blank" class="inline-flex items-center px-4 py-2 bg-blue-600 bg-opacity-20 hover:bg-opacity-30 border border-blue-500 rounded text-blue-400 transition-all">
              üîó –û—Ç–∫—Ä—ã—Ç—å REST API
            </a>
          </div>
        ` : ''}
        ${item.raw ? `
          <details class="pt-4 border-t border-gray-600">
            <summary class="cursor-pointer text-gray-400 hover:text-white">üîç –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ</summary>
            <pre class="mt-2 p-3 bg-slate-800 rounded text-xs overflow-auto max-h-40">${JSON.stringify(item.raw, null, 2)}</pre>
          </details>
        ` : ''}
      </div>
    `;
    
    modal.style.display = 'flex';
  };

  window.closeModal = function() {
    document.getElementById('detail-modal').style.display = 'none';
  };

  window.resetFilters = function() {
    document.getElementById('reset-filters').click();
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  filterItems();
});
</script>

<style>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.sort-indicator {
  font-size: 10px;
  opacity: 0.5;
}
</style>
